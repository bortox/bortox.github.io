<!doctype html><html lang=it dir=ltr class=scroll-smooth data-default-appearance=light data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="it"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>Snippet di codice per la gestione di Fail2Ban &#183; bortox.it - blog</title><meta name=title content="Snippet di codice per la gestione di Fail2Ban &#183; bortox.it - blog "><meta name=description content="Blog personale"><link rel=canonical href=https://bortox.it/article/snippet-fail2ban/><link rel=preload href=/css/main.bundle.min.edef841c223151f1f25365ad6f2251dad4f0ac5b6711d3580f4644cf629476877a33890afa744cc5a53e75edc1f2c3d408f607f5d2f8f77a136210f31bb13fdb.css as=style><link type=text/css rel=stylesheet href=/css/main.bundle.min.edef841c223151f1f25365ad6f2251dad4f0ac5b6711d3580f4644cf629476877a33890afa744cc5a53e75edc1f2c3d408f607f5d2f8f77a136210f31bb13fdb.css><link rel=preload as=script href=/js/appearance.min.badab316c9287a5a42a843e4eb45da65bb3d194a5a0f5fa4a3e516160e67df0b8c65f4f19a8e146436e29d583699e6cb41d6bbe99e05e1dbaa877763bad9f8e2.js integrity="sha512-utqzFskoelpCqEPk60XaZbs9GUpaD1+ko+UWFg5n3wuMZfTxmo4UZDbinVg2mebLQda76Z4F4duqh3djutn44g=="><script type=text/javascript src=/js/appearance.min.badab316c9287a5a42a843e4eb45da65bb3d194a5a0f5fa4a3e516160e67df0b8c65f4f19a8e146436e29d583699e6cb41d6bbe99e05e1dbaa877763bad9f8e2.js integrity="sha512-utqzFskoelpCqEPk60XaZbs9GUpaD1+ko+UWFg5n3wuMZfTxmo4UZDbinVg2mebLQda76Z4F4duqh3djutn44g=="></script>
<link rel=preload as=script href=/js/main.bundle.min.320e9d18732f8483248bd9a4e34269c64457da85f229f15f954f0334d950f968341a3d1d7d2c65612c4d5bf35d70ea8094be667fca7c7823f135ac6b80fc1ee6.js integrity="sha512-Mg6dGHMvhIMki9mk40JpxkRX2oXyKfFflU8DNNlQ+Wg0Gj0dfSxlYSxNW/NdcOqAlL5mf8p8eCPxNaxrgPwe5g=="><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.320e9d18732f8483248bd9a4e34269c64457da85f229f15f954f0334d950f968341a3d1d7d2c65612c4d5bf35d70ea8094be667fca7c7823f135ac6b80fc1ee6.js integrity="sha512-Mg6dGHMvhIMki9mk40JpxkRX2oXyKfFflU8DNNlQ+Wg0Gj0dfSxlYSxNW/NdcOqAlL5mf8p8eCPxNaxrgPwe5g==" data-copy=Copia data-copied=Copiato></script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel="alternate icon" type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/svg+xml href=/favicon.svg><link rel="alternate icon" type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="Snippet di codice per la gestione di Fail2Ban"><meta property="og:description" content="Appunti sulla configurazione ed attivazione di Fail2Ban per proteggere il proprio server da attacchi informatici."><meta property="og:type" content="article"><meta property="og:url" content="https://bortox.it/article/snippet-fail2ban/"><meta property="article:section" content="article"><meta property="article:published_time" content="2022-02-28T20:21:02+00:00"><meta property="article:modified_time" content="2022-02-28T20:21:02+00:00"><meta property="og:site_name" content="bortox.it - blog "><meta name=twitter:card content="summary"><meta name=twitter:title content="Snippet di codice per la gestione di Fail2Ban"><meta name=twitter:description content="Appunti sulla configurazione ed attivazione di Fail2Ban per proteggere il proprio server da attacchi informatici."><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Benvenuti su BBlog","name":"Snippet di codice per la gestione di Fail2Ban","headline":"Snippet di codice per la gestione di Fail2Ban","description":"Appunti sulla configurazione ed attivazione di Fail2Ban per proteggere il proprio server da attacchi informatici.","abstract":"\u003cp\u003eBreve guida all\u0026rsquo;uso di Fail2Ban, appunti personali con diversi snippet. Argomenti trattati in breve:\u003c\/p\u003e\n\u003cul\u003e\n\u003cli\u003eCome creare filtri e jail Fail2Ban per i tentativi d\u0026rsquo;accesso ad un\u0026rsquo;applicazione web come Wallabag\u003c\/li\u003e\n\u003cli\u003eCome configurare una jail per gli IP recidivi\u003c\/li\u003e\n\u003cli\u003eCome ricevere un messaggio via telegram quando un IP viene bannato\u003c\/li\u003e\n\u003cli\u003eCome modificare le impostazioni predefinite\u003c\/li\u003e\n\u003c\/ul\u003e","inLanguage":"it","url":"https:\/\/bortox.it\/article\/snippet-fail2ban\/","author":{"@type":"Person","name":"Andrea Bortolotti"},"copyrightYear":"2022","dateCreated":"2022-02-28T20:21:02\u002b00:00","datePublished":"2022-02-28T20:21:02\u002b00:00","dateModified":"2022-02-28T20:21:02\u002b00:00","keywords":["fail2ban","server"],"mainEntityOfPage":"true","wordCount":"1392"}]</script><meta name=author content="Andrea Bortolotti"><link href=mailto:bort0x@tuta.io rel=me><link href=https://github.com/bortox rel=me><link href="https://www.google.com/search?q=site:bortox.it" rel=me><link href=https://t.me/il_bortox rel=me><script async data-goatcounter=https://contacapre.bortox.it/count src=/count.js></script>
<script async src=/share.js></script><meta name=theme-color content="#8A2BE2"><link rel=dns-prefetch href=https://bortox.goatcounter.com><link rel=dns-prefetch href=https://contacapre.bortox.it><link rel=preload href=/count.js as=script></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 bg-neutral text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral max-w-7xl"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 dark:bg-neutral-600 focus:translate-y-0" href=#main-content><span class="font-bold ltr:pr-2 rtl:pl-2 text-primary-600 dark:text-primary-400">&darr;</span>Raggiungi il contenuto principale</a></div><header class="flex justify-between py-6 font-semibold sm:items-center sm:py-10 text-neutral-900 dark:text-neutral print:hidden"><div><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/>bortox.it - blog</a></div><nav><ul class="flex flex-col list-none sm:flex-row"><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/ title="Benvenuto su bortox.it :tada:">🏠</a></li><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/article/ title="Benvenuti su BBlog">👨‍💻</a></li><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=https://bortox.it/galleria/ title>📷</a></li><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=https://bortox.it/Compiti-scolastici/ title>📝</a></li><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href="https://www.paypal.com/donate/?hosted_button_id=96RXFETTZFDPQ" title>Donazione 💶</a></li><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/categories/ title=Categories>Categorie</a></li><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/tags/ title=Tags>Tag</a></li><li class="ltr:text-right rtl:text-left ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><button id=search-button class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="Cerca (/)">
<span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button></li></ul></nav></header><main id=main-content class="relative grow"><article><header class=max-w-prose><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/>Benvenuto su bortox.it :tada:</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/article/>Benvenuti su BBlog</a><span class="px-1 text-primary-500">/</span></li><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/article/snippet-fail2ban/>Snippet di codice per la gestione di Fail2Ban</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Snippet di codice per la gestione di Fail2Ban</h1><div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2022-02-28 20:21:02.031 +0000 UTC">28/02/22</time><span class="px-2 text-primary-500">&#183;</span><span>1392 parole</span><span class="px-2 text-primary-500">&#183;</span><span title="Tempo di lettura">7 min</span><span class="px-2 text-primary-500">&#183;</span>
<span class=mb-[2px]><a href=https://github.com/bortox/bortox.github.io/tree/main/content/article/snippet-fail2ban.md class="text-lg hover:text-primary-500" rel="noopener noreferrer" target=_blank title="Modifica contenuto"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M490.3 40.4c21.9 21.87 21.9 57.33.0 79.2l-30 30.1-98-97.98 30.1-30.06C414.3-.2135 449.7-.2135 471.6 21.66L490.3 40.4zM172.4 241.7 339.7 74.34l98 97.96L270.3 339.6C264.2 345.8 256.7 350.4 248.4 353.2l-88.8 29.6C150.1 385.6 141.5 383.4 135 376.1 128.6 370.5 126.4 361 129.2 352.4l29.6-88.8C161.6 255.3 166.2 247.8 172.4 241.7v0zM192 63.1c17.7.0 32 15.23 32 32 0 18.6-14.3 32-32 32H96c-17.67.0-32 15.2-32 32V416c0 17.7 14.33 32 32 32H352c17.7.0 32-14.3 32-32V319.1c0-16.8 14.3-32 32-32s32 15.2 32 32V416c0 53-43 96-96 96H96c-53.02.0-96-43-96-96V159.1c0-53 42.98-96 96-96h96z"/></svg></span></a></span></div><div class="my-1 text-xs text-neutral-500 dark:text-neutral-400"><a href=/categories/tutorial/ class="px-1 py-[1px] border rounded-md border-neutral-200 dark:border-neutral-600 hover:border-primary-300 hover:text-primary-700 dark:hover:border-primary-600 dark:hover:text-primary-400">tutorial</a>
<a href=/categories/linux/ class="px-1 py-[1px] border rounded-md border-neutral-200 dark:border-neutral-600 hover:border-primary-300 hover:text-primary-700 dark:hover:border-primary-600 dark:hover:text-primary-400">linux</a>
<a href=/tags/fail2ban/ class="px-1 py-[1px] border rounded-md border-neutral-200 dark:border-neutral-600 hover:border-primary-300 hover:text-primary-700 dark:hover:border-primary-600 dark:hover:text-primary-400">fail2ban</a>
<a href=/tags/server/ class="px-1 py-[1px] border rounded-md border-neutral-200 dark:border-neutral-600 hover:border-primary-300 hover:text-primary-700 dark:hover:border-primary-600 dark:hover:text-primary-400">server</a>
<button share_title="Snippet di codice per la gestione di Fail2Ban" share_description="Appunti sulla configurazione ed attivazione di Fail2Ban per proteggere il proprio server da attacchi informatici." share_permalink=https://bortox.it/article/snippet-fail2ban/ share_dialogue="Condividi ora 'Snippet di codice per la gestione di …'" class="sharebtn px-1 py-[1px] border rounded-md border-neutral-200 dark:border-neutral-600 hover:border-primary-300 hover:text-primary-700 dark:hover:border-primary-600 dark:hover:text-primary-400">✌️ Condividi ✌️</a></div></div></header><section class="flex flex-col max-w-full mt-0 prose lg:flex-row dark:prose-invert"><div class="order-first px-0 lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8 lg:order-last"><div class="ltr:pl-5 rtl:pr-5 toc lg:sticky lg:top-10 print:hidden"><details open class="mt-0 overflow-hidden rounded-lg rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 lg:mt-3"><summary class="block py-1 text-lg font-semibold cursor-pointer rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 text-neutral-800 dark:text-neutral-100 lg:hidden bg-neutral-100 dark:bg-neutral-700">Tabella dei contenuti</summary><div class="py-2 border-dotted ltr:border-l rtl:border-r rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 border-neutral-300 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#installare-ed-abilitare-fail2ban>Installare ed abilitare fail2ban</a></li><li><a href=#controllare-gli-ip-bloccati-per-ogni-jail>Controllare gli IP bloccati per ogni jail</a></li><li><a href=#scrivere-una-nuova-regola-per-trovare-tentativi-di-accesso-da-parte-di-bot>Scrivere una nuova regola per trovare tentativi di accesso da parte di bot</a></li><li><a href=#creare-un-filtro>Creare un filtro</a><ul><li><a href=#controllare-se-il-filtro-trova-tentativi-daccesso>Controllare se il filtro trova tentativi d&rsquo;accesso</a></li></ul></li><li><a href=#attivare-una-jail-per-gli-ip-trovati-da-un-filtro>Attivare una jail per gli IP trovati da un filtro</a></li><li><a href=#modificare-le-impostazioni-di-jail-predefinite>Modificare le impostazioni di jail predefinite.</a><ul><li><a href=#attivare-una-jail-per-gli-ip-recidivi>Attivare una jail per gli IP recidivi</a></li><li><a href=#azione-per-inviare-un-messaggio-telegram-quando-un-ip-viene-bannato>Azione per inviare un messaggio Telegram quando un IP viene bannato</a></li></ul></li><li><a href=#fonti>Fonti</a></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-prose"><p>Breve guida all&rsquo;uso di Fail2Ban, appunti personali con diversi snippet. Argomenti trattati in breve:</p><ul><li>Come creare filtri e jail Fail2Ban per i tentativi d&rsquo;accesso ad un&rsquo;applicazione web come Wallabag</li><li>Come configurare una jail per gli IP recidivi</li><li>Come ricevere un messaggio via telegram quando un IP viene bannato</li><li>Come modificare le impostazioni predefinite</li></ul><h2 id=installare-ed-abilitare-fail2ban class="relative group">Installare ed abilitare fail2ban <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#installare-ed-abilitare-fail2ban aria-label=Ancora>#</a></span></h2><ol><li>Installare fail2ban</li></ol><p><code>apt install fail2ban</code></p><ol start=2><li>Abilitare il servizio</li></ol><p><code>systemctl enable --now fail2ban</code></p><h2 id=controllare-gli-ip-bloccati-per-ogni-jail class="relative group">Controllare gli IP bloccati per ogni jail <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#controllare-gli-ip-bloccati-per-ogni-jail aria-label=Ancora>#</a></span></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>fail2ban-client status <span class=p>|</span> sed -n <span class=s1>&#39;s/,//g;s/.*Jail list://p&#39;</span> <span class=p>|</span> xargs -n1 fail2ban-client status
</span></span></code></pre></div><h2 id=scrivere-una-nuova-regola-per-trovare-tentativi-di-accesso-da-parte-di-bot class="relative group">Scrivere una nuova regola per trovare tentativi di accesso da parte di bot <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#scrivere-una-nuova-regola-per-trovare-tentativi-di-accesso-da-parte-di-bot aria-label=Ancora>#</a></span></h2><p>Fail2Ban sfrutta prima dei file formattati per indicare come trovare i tentativi d&rsquo;accesso falliti in un file di log, che chiameremo <strong>filtri</strong> (in /filters.d), poi sfrutta altri file per indicare come bloccare gli indirizzi IP dopo un certo numero di tentativi falliti, in delle <strong>jail</strong> (in /jail.d), questi file configurano le jail.</p><p>Per prima cosa, <code>cd /etc/fail2ban</code>, la cartella di lavoro di fail2ban.</p><p>Serve un <strong>filtro</strong> che scannerizza i log (di systemd oppure file testuali) attraverso una regex per trovare linee che corrispondono a tentativi d&rsquo;accesso falliti da parte di un IP.</p><p>Il filtro trova appunto queste linee e le comunica come &ldquo;failed&rdquo; alla jail.</p><p>Se i fallimenti di un IP sono più di un certo valore in un dato periodo di tempo, l&rsquo;IP viene bannato.</p><p>Ogni filtro sta in <code>/etc/fail2ban/filter.d/nomefiltro.conf</code>.</p><h2 id=creare-un-filtro class="relative group">Creare un filtro <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#creare-un-filtro aria-label=Ancora>#</a></span></h2><p>Esempio: Creiamo il filtro <code>wallabag2.conf</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>[</span>INCLUDES<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>before</span> <span class=o>=</span> common.conf
</span></span><span class=line><span class=cl><span class=o>[</span>Definition<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>failregex</span> <span class=o>=</span> app.ERROR: Authentication failure <span class=k>for</span> user <span class=s2>&#34;([\w]+)?&#34;</span>, from IP <span class=s2>&#34;&lt;HOST&gt;&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>ignoreregex</span> <span class=o>=</span>
</span></span></code></pre></div><p>In <code>failregex</code> sta la regex che trova le linee contenenti le autenticazioni fallite, tutti gli IP trovati con in <code>ignoreregex</code> saranno ignorati</p><div class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900"><span class="ltr:pr-3 rtl:pl-3 text-primary-400"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M506.3 417 293 53c-16.33-28-57.54-28-73.98.0l-213.2 364C-10.59 444.9 9.849 480 42.74 480h426.6c32.76.0 53.26-35 36.96-63zM232 168c0-13.25 10.75-24 24-24s24 10.8 24 24v128c0 13.25-10.75 24-23.1 24S232 309.3 232 296V168zm24 248c-17.36.0-31.44-14.08-31.44-31.44s14.07-31.44 31.44-31.44 31.44 14.08 31.44 31.44C287.4 401.9 273.4 416 256 416z"/></svg></span></span><span class=dark:text-neutral-300><blockquote><p><strong>NON</strong> cambiare <code>common.conf</code>, bensì crea un file <code>common.local</code> per applicare modifiche locali.</p></blockquote></span></div><h3 id=controllare-se-il-filtro-trova-tentativi-daccesso class="relative group">Controllare se il filtro trova tentativi d&rsquo;accesso <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#controllare-se-il-filtro-trova-tentativi-daccesso aria-label=Ancora>#</a></span></h3><p>Per controllare se questo filtro funziona, utilizziamo
<code>fail2ban-regex [/path/file-di-log] [/path/filtro]</code></p><p>In seguito, se fail2ban-regex trova alcuni match di righe <strong>failed</strong>, significa che sono avvenuti dei tentativi d&rsquo;accesso.</p><p>Possiamo creare un file di log falso con dei tentativi d&rsquo;accesso falliti per testare questa regola con <code>fail2ban-regex</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Esempio di test con file di log falso</span>
</span></span><span class=line><span class=cl>touch /tmp/error-test.log
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;[2022-01-23 12:04:53] app.ERROR: Authentication failure for user &#34;</span>admin<span class=s2>&#34;, from IP &#34;</span>xxx.xxx.xxx.xxx<span class=s2>&#34;, with UA: &#34;</span>Mozilla/5.0 <span class=o>(</span>Windows NT 10.0<span class=p>;</span> Win64<span class=p>;</span> x64<span class=p>;</span> rv:96.0<span class=o>)</span> Gecko/20100101 Firefox/96.0<span class=s2>&#34;. [] []&#34;</span> &gt;&gt; /tmp/error/test.log
</span></span><span class=line><span class=cl>fail2ban-regex /tmp/error-test.log wallabag2
</span></span></code></pre></div><h2 id=attivare-una-jail-per-gli-ip-trovati-da-un-filtro class="relative group">Attivare una jail per gli IP trovati da un filtro <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#attivare-una-jail-per-gli-ip-trovati-da-un-filtro aria-label=Ancora>#</a></span></h2><p>Continiuamo l&rsquo;esempio riguardante l&rsquo;identificazione degli IP che tentano di accedere a Wallabag tramite il filtro appena scritto.</p><p>Il file di configurazione per la <strong>jail</strong> degli IP si chiamerà <code>wallabag2.conf</code>, non serve un nome particolare.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>[</span>wallabag2<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>enabled</span> <span class=o>=</span> <span class=nb>true</span>
</span></span><span class=line><span class=cl><span class=nv>port</span> <span class=o>=</span> http,https
</span></span><span class=line><span class=cl><span class=nv>filter</span> <span class=o>=</span> wallabag2
</span></span><span class=line><span class=cl><span class=nv>logpath</span> <span class=o>=</span> /var/www/wallabag2/var/logs/prod.log
</span></span><span class=line><span class=cl><span class=nv>maxretry</span> <span class=o>=</span> <span class=m>5</span> 
</span></span></code></pre></div><span class=flex><span class="ltr:ml-1 rtl:mr-1 px-1 py-[1px] text-xs font-normal border rounded-md text-primary-700 dark:text-primary-400 border-primary-400 dark:border-primary-600">Tutti i file per configurare le jail hanno un percorso come `jail.d/nome-file.conf`.</span></span><div class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900"><span class="ltr:pr-3 rtl:pl-3 text-primary-400"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M506.3 417 293 53c-16.33-28-57.54-28-73.98.0l-213.2 364C-10.59 444.9 9.849 480 42.74 480h426.6c32.76.0 53.26-35 36.96-63zM232 168c0-13.25 10.75-24 24-24s24 10.8 24 24v128c0 13.25-10.75 24-23.1 24S232 309.3 232 296V168zm24 248c-17.36.0-31.44-14.08-31.44-31.44s14.07-31.44 31.44-31.44 31.44 14.08 31.44 31.44C287.4 401.9 273.4 416 256 416z"/></svg></span></span><span class=dark:text-neutral-300>In un file <code>.conf</code> possono essere configurate più jail, ogni jail viene definita dalla riga <code>[nome-jail]</code>, in questo caso <code>[wallabag2]</code></span></div><ul><li><code>enabled</code>, ovviamente, attiva il filtro.</li><li><code>port</code>, corrisponde alle porte su cui l&rsquo;indirizzo IP sarà bloccato.</li><li><code>filter</code> indica il nome del filtro, se posizionato in <code>/etc/fail2ban/filter.d</code>, altrimenti va bene anche il percorso. Se non viene dichiarato qua, sarà uguale alla variabile tra le parentesi quadre.</li><li><code>logpath</code> indica il percorso dei file da interpretare attraverso il filtro. Io di solito aggiungo un bel <code>*</code> alla fine siccome ho la rotazione dei log, tanto per stare sicuri.</li><li><code>maxretry</code> è il numero massimo di tentativi.</li><li><code>bantime</code> è il tempo in cui durerà il ban in secondi. Impostando <code>-1</code> il ban è permanente.</li><li><code>findtime</code> indica il tempo in cui è consentito ad un IP fallire fino a <code>maxretry</code>.</li><li><code>action</code> indica l&rsquo;azione da intraprendere quando un IP viene bannato.</li></ul><h2 id=modificare-le-impostazioni-di-jail-predefinite class="relative group">Modificare le impostazioni di jail predefinite. <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#modificare-le-impostazioni-di-jail-predefinite aria-label=Ancora>#</a></span></h2><p>Come si può vedere, le impostazioni di jail predefinite, stanno in <code>/etc/fail2ban/jail.conf/</code>. Come vediamo dalle righe presenti all&rsquo;inizio del file</p><blockquote><p>Provide customizations in a jail.local file or a jail.d/customisation.local.</p></blockquote><p>Per applicare i nostri cambiamenti, creiamo il file <code>jail.d/customisation.local</code>; meglio non toccare <code>/etc/fail2ban/jail.conf/</code>, sia perché potrebbe cambiare dopo un aggiornamento sia perché nel caso di un errore nella nostra configurazione, basterà -nello scenario peggiore- eliminare <code>customisation.local</code> dunque tornare alle impostazioni predefinite contenute in <code>jail.conf</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>[</span>sshd<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>enabled</span> <span class=o>=</span> <span class=nb>true</span>
</span></span><span class=line><span class=cl><span class=nv>logpath</span> <span class=o>=</span> /var/log/auth.log*
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>DEFAULT<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>bantime</span> <span class=o>=</span> <span class=m>600</span>
</span></span><span class=line><span class=cl><span class=nv>findtime</span> <span class=o>=</span> <span class=m>600</span>
</span></span><span class=line><span class=cl><span class=nv>maxretry</span> <span class=o>=</span> <span class=m>3</span>
</span></span><span class=line><span class=cl><span class=nv>backend</span> <span class=o>=</span> auto
</span></span><span class=line><span class=cl><span class=nv>usedns</span> <span class=o>=</span> warn
</span></span></code></pre></div><h3 id=attivare-una-jail-per-gli-ip-recidivi class="relative group">Attivare una jail per gli IP recidivi <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#attivare-una-jail-per-gli-ip-recidivi aria-label=Ancora>#</a></span></h3><p>Gli IP che sono presenti nel log di Fail2Ban come IP bannati saranno analizzati da un filtro di Fail2Ban stesso ed inseriti in una jail apposita.</p><p>Nel mio caso, una volta che un IP viene bannato per tre volte - dunque quando è <strong>recidivo</strong>, il <code>bantime</code> invece di 600 secondi sale ad 864000 secondi (10 giorni).</p><p>File del filtro: <code>filter.d/recidive.conf</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># Fail2Ban filter for repeat bans</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># This filter monitors the fail2ban log file, and enables you to add long </span>
</span></span><span class=line><span class=cl><span class=c1># time bans for ip addresses that get banned by fail2ban multiple times.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># Reasons to use this: block very persistent attackers for a longer time, </span>
</span></span><span class=line><span class=cl><span class=c1># stop receiving email notifications about the same attacker over and </span>
</span></span><span class=line><span class=cl><span class=c1># over again.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># This jail is only useful if you set the &#39;findtime&#39; and &#39;bantime&#39; parameters </span>
</span></span><span class=line><span class=cl><span class=c1># in jail.conf to a higher value than the other jails. Also, this jail has its</span>
</span></span><span class=line><span class=cl><span class=c1># drawbacks, namely in that it works only with iptables, or if you use a </span>
</span></span><span class=line><span class=cl><span class=c1># different blocking mechanism for this jail versus others (e.g. hostsdeny </span>
</span></span><span class=line><span class=cl><span class=c1># for most jails, and shorewall for this one).</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>INCLUDES<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Read common prefixes. If any customizations available -- read them from</span>
</span></span><span class=line><span class=cl><span class=c1># common.local</span>
</span></span><span class=line><span class=cl><span class=nv>before</span> <span class=o>=</span> common.conf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>Definition<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>_daemon</span> <span class=o>=</span> fail2ban<span class=se>\.</span>actions<span class=se>\s</span>*
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># The name of the jail that this filter is used for. In jail.conf, name the </span>
</span></span><span class=line><span class=cl><span class=c1># jail using this filter &#39;recidive&#39;, or change this line!</span>
</span></span><span class=line><span class=cl><span class=nv>_jailname</span> <span class=o>=</span> recidive
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>failregex</span> <span class=o>=</span> ^<span class=o>(</span>%<span class=o>(</span>__prefix_line<span class=o>)</span>s<span class=p>|</span> %<span class=o>(</span>_daemon<span class=o>)</span>s%<span class=o>(</span>__pid_re<span class=o>)</span>s?:<span class=se>\s</span>+<span class=o>)</span>NOTICE<span class=se>\s</span>+<span class=se>\[</span><span class=o>(</span>?!%<span class=o>(</span>_jailname<span class=o>)</span>s<span class=se>\]</span><span class=o>)(</span>?:.*<span class=o>)</span><span class=se>\]\s</span>+Ban<span class=se>\s</span>+&lt;HOST&gt;<span class=se>\s</span>*$
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>ignoreregex</span> <span class=o>=</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>Init<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>journalmatch</span> <span class=o>=</span> <span class=nv>_SYSTEMD_UNIT</span><span class=o>=</span>fail2ban.service <span class=nv>PRIORITY</span><span class=o>=</span><span class=m>5</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Author: Tom Hendrikx, modifications by Amir Caspi </span>
</span></span></code></pre></div><p>Righe aggiunte per definire la jail, per esempio a <code>jail.d/my-jails.conf</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=na>[recidive] # Nome della Jail</span>
</span></span><span class=line><span class=cl><span class=na>enabled</span> <span class=o>=</span> <span class=s>true</span>
</span></span><span class=line><span class=cl><span class=na>maxretry</span> <span class=o>=</span> <span class=s>3</span>
</span></span><span class=line><span class=cl><span class=na>findtime</span> <span class=o>=</span> <span class=s>86400</span>
</span></span><span class=line><span class=cl><span class=na>bantime</span> <span class=o>=</span> <span class=s>864000</span>
</span></span><span class=line><span class=cl><span class=na>banaction</span> <span class=o>=</span> <span class=s>%(banaction_allports)s</span>
</span></span><span class=line><span class=cl><span class=na>action</span> <span class=o>=</span> <span class=s>telegram[name=RECIDIVO]</span>
</span></span></code></pre></div><h3 id=azione-per-inviare-un-messaggio-telegram-quando-un-ip-viene-bannato class="relative group">Azione per inviare un messaggio Telegram quando un IP viene bannato <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#azione-per-inviare-un-messaggio-telegram-quando-un-ip-viene-bannato aria-label=Ancora>#</a></span></h3><p>C&rsquo;è anche un altro tipo di file interessante. che configura l&rsquo;azione da prendere una volta bloccato l&rsquo;IP. Questo file viene invocato con la riga <code>action</code> nei file della configurazione della jail, una volta che un IP viene rinchiuso nella jail. Con un file action ,ad esempio, posso farmi inviare un messaggio via Telegram quando un IP viene bloccato, oppure segnalare l&rsquo;IP a Cloudflare. Questi file stanno in <code>action.d</code>.</p><p>File: <code>action.d/telegram.conf</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>[</span>Definition<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>chat_id</span> <span class=o>=</span> Find by sending message to @get_id_bot
</span></span><span class=line><span class=cl><span class=nv>token</span> <span class=o>=</span> Create new bot and get token by messaging @BotFather
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>actionstart</span> <span class=o>=</span> /usr/bin/curl -sSf -X POST https://api.telegram.org/bot%<span class=o>(</span>token<span class=o>)</span>s/sendMessage --data <span class=nv>chat_id</span><span class=o>=</span>%<span class=o>(</span>chat_id<span class=o>)</span>s --data <span class=nv>text</span><span class=o>=</span><span class=s2>&#34;[F2B] - Jail &lt;name&gt; avviata sul server.&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>actionstop</span>  <span class=o>=</span> /usr/bin/curl -sSf -X POST https://api.telegram.org/bot%<span class=o>(</span>token<span class=o>)</span>s/sendMessage --data <span class=nv>chat_id</span><span class=o>=</span>%<span class=o>(</span>chat_id<span class=o>)</span>s --data <span class=nv>text</span><span class=o>=</span><span class=s2>&#34;[F2B] - Jail &lt;name&gt; fermata sul server.&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>actioncheck</span> <span class=o>=</span>
</span></span><span class=line><span class=cl><span class=nv>actionban</span>   <span class=o>=</span> /usr/bin/curl -sSf -X POST https://api.telegram.org/bot%<span class=o>(</span>token<span class=o>)</span>s/sendMessage --data <span class=nv>chat_id</span><span class=o>=</span>%<span class=o>(</span>chat_id<span class=o>)</span>s --data <span class=nv>text</span><span class=o>=</span><span class=s2>&#34;[F2B] - &lt;IP&gt; appena bannato da Fail2ban dopo &lt;failures&gt; tentativi contro la jail &lt;name&gt; sul server.&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>actionunban</span> <span class=o>=</span> /usr/bin/curl -sSf -X POST https://api.telegram.org/bot%<span class=o>(</span>token<span class=o>)</span>s/sendMessage --data <span class=nv>chat_id</span><span class=o>=</span>%<span class=o>(</span>chat_id<span class=o>)</span>s --data <span class=nv>text</span><span class=o>=</span><span class=s2>&#34;[F2B] - &lt;IP&gt; appena sbannato dal server.&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>Init<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>init</span> <span class=o>=</span> <span class=s2>&#34;Fail2ban Telegram è attivo&#34;</span>
</span></span></code></pre></div><ul><li><code>actionstart</code> quando una jail viene attivata</li></ul><p>Per esempio dopo <code>systemctl start fail2ban</code></p><ul><li><code>actionstop</code> quando una jail viene fermata</li></ul><p>Per esempio dopo <code>systemctl stop fail2ban</code></p><ul><li><code>actionban</code> quando un IP viene bannato</li></ul><p>Quando ha superato <code>maxretry</code> tentativi in <code>findtime</code> sarà bannato per <code>bantime</code>.</p><ul><li><code>actionunban</code></li></ul><p>Quando un IP viene sbannato, dopo che è trascorso <code>bantime</code> dal momento in cui è stato bannato.</p><ul><li><code>actioncheck</code> comando eseguito prima di qualsiasi azione.</li></ul><hr><p>Per attivare quest&rsquo;azione, inserire la riga <code>action = telegram[nome-jail]</code> nel file di configurazione di una jail.</p><p>Esempio in un potenziale file file <code>jails.conf</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>[</span>sshd<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>enabled</span> <span class=o>=</span> <span class=nb>true</span>
</span></span><span class=line><span class=cl><span class=nv>action</span> <span class=o>=</span> telegram<span class=o>[</span><span class=nv>name</span><span class=o>=</span>SSHD<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>postfix<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>enabled</span> <span class=o>=</span> <span class=nb>true</span>
</span></span><span class=line><span class=cl><span class=nv>action</span> <span class=o>=</span> telegram<span class=o>[</span><span class=nv>name</span><span class=o>=</span>POSTFIX<span class=o>]</span>
</span></span></code></pre></div><hr><p>Per questa azione si invoca curl ad inviare un messaggio POST all&rsquo;API di Telegram per un BOT che dovrà inviare un messaggio diretto a noi, con chat_id. Questo metodo è stato brutalmente copiato (con un paio di semplificazioni al file dell&rsquo;azione) da <a href=https://illuad.fr/2020/10/28/receive-messages-on-telegram-from-fail2ban.html>Receive messages on Telegram from Fail2ban</a>.</p><h2 id=fonti class="relative group">Fonti <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#fonti aria-label=Ancora>#</a></span></h2><p>Manpages di Debian su Fail2Ban:</p><ul><li><a href=https://manpages.debian.org/testing/fail2ban>Fail2Ban</a></li><li><a href=https://manpages.debian.org/testing/fail2ban/fail2ban-regex.1.en.html>Fail2Ban-regex</a></li><li><a href=https://manpages.debian.org/testing/fail2ban/jail.conf.5.en.html#actioncheck>jail.conf</a></li></ul><p>Messaggio via Telegram quando IP bannati</p><ul><li><a href=https://illuad.fr/2020/10/28/receive-messages-on-telegram-from-fail2ban.html>Receive messages on Telegram from Fail2ban</a></li><li><a href=https://www.digitalocean.com/community/tutorials/how-fail2ban-works-to-protect-services-on-a-linux-server>How Fail2Ban works (filter and jail configuration)</a></li></ul><p>DigitalOcean su Fail2Ban</p><ul><li><a href=https://www.digitalocean.com/community/tutorials/how-to-protect-an-nginx-server-with-fail2ban-on-ubuntu-14-04>Fail2Ban on Ubuntu 14.04</a></li></ul><p>Altro</p><ul><li><a href=https://www.burlutsky.su/security/fail2ban-http-404-error-rules-for-web-frontends-nginx-haproxy-http/>Fail2Ban 404</a></li></ul><p>Altro, in Italiano:</p><ul><li><a href=https://www.nickworlds.it/fail2ban-e-postfix/>Fail2Ban e Postfix</a></li></ul></div></section><footer class="pt-8 max-w-prose print:hidden"><button share_title="Snippet di codice per la gestione di Fail2Ban" share_description="Appunti sulla configurazione ed attivazione di Fail2Ban per proteggere il proprio server da attacchi informatici." share_permalink=https://bortox.it/article/snippet-fail2ban/ share_dialogue="Condividi 'Snippet di codice per la gestione di …'" class="sharebtn mb-2 px-1 py-[1px] border rounded-md border-neutral-200 dark:border-neutral-600 hover:border-primary-300 hover:text-primary-700 dark:hover:border-primary-600 dark:hover:text-primary-400">Condividi <i>Snippet di codice per la gestione di …</i> ✌️</button>
<script src=https://giscus.app/client.js data-repo=bortox/bortox.github.io data-repo-id=R_kgDOHRi0nA data-category=Announcements data-category-id=DIC_kwDOHRi0nM4CQ7A6 data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=1 data-input-position=top data-theme=preferred_color_scheme data-lang=it data-loading=lazy crossorigin=anonymous async></script><div class="flex mt-6"><picture><source type=image/webp srcset=/author_huf462b8f845b0daeb49eda52c2130fd01_38394_5f2ab3a9a997a791724889122eeb2e77.webp width=192 height=192><img class="w-24 h-24 !mt-0 !mb-0 ltr:mr-4 rtl:ml-4 rounded-full" width=96 height=96 alt="Andrea Bortolotti" src=/author_huf462b8f845b0daeb49eda52c2130fd01_38394_192x192_fill_mitchellnetravali_smart1_3.png></picture><div class="place-self-center ml-2"><div class="text-[0.6rem] leading-3 text-neutral-500 dark:text-neutral-400 uppercase">Autore</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Andrea Bortolotti</div><div class="text-sm text-neutral-700 dark:text-neutral-400">Ciao, sono uno studente. <a href=https://bortox.it/contribuisci-cs>✨ <strong>sostieni</strong> bortox.it ✨</a></div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=mailto:bort0x@tuta.io target=_blank aria-label=Email rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/bortox target=_blank aria-label=Github rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href="https://www.google.com/search?q=site:bortox.it" target=_blank aria-label=Google rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 488 512"><path fill="currentcolor" d="M488 261.8C488 403.3 391.1 504 248 504 110.8 504 0 393.2.0 256S110.8 8 248 8c66.8.0 123 24.5 166.3 64.9l-67.5 64.9C258.5 52.6 94.3 116.6 94.3 256c0 86.5 69.1 156.6 153.7 156.6 98.2.0 135-70.4 140.8-106.9H248v-85.3h236.1c2.3 12.7 3.9 24.9 3.9 41.4z"/></svg></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://t.me/il_bortox target=_blank aria-label=Telegram rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M248 8C111.033 8 0 119.033.0 256S111.033 504 248 504 496 392.967 496 256 384.967 8 248 8zM362.952 176.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452.0 013.53 6.716A43.765 43.765.0 01362.952 176.66z"/></svg></span></a></div></div></div></div><div class="mt-8 ltr:lg:pl-8 rtl:lg:pr-8"></div><section class="flex flex-row flex-wrap justify-center pt-4 text-xl"><a class="bg-neutral-300 text-neutral-700 dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800 m-1 hover:bg-primary-500 hover:text-neutral rounded min-w-[2.4rem] inline-block text-center p-1" href="https://www.facebook.com/sharer/sharer.php?u=https://bortox.it/article/snippet-fail2ban/&quote=Snippet%20di%20codice%20per%20la%20gestione%20di%20Fail2Ban" title="Condividi su Facebook" aria-label="Condividi su Facebook"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14.0 55.52 4.84 55.52 4.84v61h-31.28c-30.8.0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg></span></a><a class="bg-neutral-300 text-neutral-700 dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800 m-1 hover:bg-primary-500 hover:text-neutral rounded min-w-[2.4rem] inline-block text-center p-1" href="https://twitter.com/intent/tweet/?url=https://bortox.it/article/snippet-fail2ban/&text=Snippet%20di%20codice%20per%20la%20gestione%20di%20Fail2Ban" title="Twitta on Twitter" aria-label="Twitta on Twitter"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></span></a><a class="bg-neutral-300 text-neutral-700 dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800 m-1 hover:bg-primary-500 hover:text-neutral rounded min-w-[2.4rem] inline-block text-center p-1" href="https://reddit.com/submit/?url=https://bortox.it/article/snippet-fail2ban/&resubmit=true&title=Snippet%20di%20codice%20per%20la%20gestione%20di%20Fail2Ban" title="Invia a Reddit" aria-label="Invia a Reddit"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M201.5 305.5c-13.8.0-24.9-11.1-24.9-24.6.0-13.8 11.1-24.9 24.9-24.9 13.6.0 24.6 11.1 24.6 24.9.0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4.0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7.0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9.0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5.0 52.6 59.2 95.2 132 95.2 73.1.0 132.3-42.6 132.3-95.2.0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6.0-2.2-2.2-6.1-2.2-8.3.0-2.5 2.5-2.5 6.4.0 8.6 22.8 22.8 87.3 22.8 110.2.0 2.5-2.2 2.5-6.1.0-8.6-2.2-2.2-6.1-2.2-8.3.0zm7.7-75c-13.6.0-24.6 11.1-24.6 24.9.0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.1 24.9-24.6.0-13.8-11-24.9-24.9-24.9z"/></svg></span></a><a class="bg-neutral-300 text-neutral-700 dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800 m-1 hover:bg-primary-500 hover:text-neutral rounded min-w-[2.4rem] inline-block text-center p-1" href="mailto:?body=https://bortox.it/article/snippet-fail2ban/&subject=Snippet%20di%20codice%20per%20la%20gestione%20di%20Fail2Ban" title="Invia via email" aria-label="Invia via email"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg></span></a></section><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group" rel=prefetch href=/article/discord-webhook/><span class="mr-3 ltr:inline rtl:hidden text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 ltr:hidden rtl:inline text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Creare un Discord Webhook ed inviare messaggi con Python</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2021-10-16 14:47:00 +0000 UTC">16/10/21</time></span></span></a></span>
<span><a class="flex text-right group" rel=prefetch href=/article/trasferire-cartella-webserver/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Trasferire una cartella tra due computer linux sulla stessa rete locale con wget e http.server</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2022-05-01 17:21:00.001 +0000 UTC">1/05/22</time></span></span>
<span class="ml-3 ltr:inline rtl:hidden text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 ltr:hidden rtl:inline text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&larr;</span></a></span></div></div></footer></article><div class="absolute top-[110vh] ltr:right-0 rtl:left-0 w-12 pointer-events-none bottom-[-8.25rem] sm:bottom-[-8rem]"><a href=#the-top class="w-12 h-12 sticky pointer-events-auto top-[calc(100vh-5rem)] bg-neutral/50 dark:bg-neutral-800/50 backdrop-blur rounded-full text-xl flex items-center justify-center text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400" aria-label="Scorri in cima." title="Scorri in cima.">&uarr;</a></div></main><div id=search-wrapper class="fixed inset-0 z-50 flex flex-col p-4 sm:p-6 md:p-[10vh] lg:p-[12vh] w-screen h-screen cursor-default bg-neutral-500/50 backdrop-blur-sm dark:bg-neutral-900/50 invisible" data-url=https://bortox.it/><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg border-neutral-200 top-20 bg-neutral dark:bg-neutral-800 dark:border-neutral-700"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-transparent focus:outline-2" placeholder="Query di ricerca" tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400" title="Chiudi (Esc)">
<span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div><footer class="py-10 print:hidden"><nav class="pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex flex-col list-none sm:flex-row"><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/ title="Benvenuto su bortox.it :tada:">🏠</a></li><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/categories/ title=Categories>Categorie</a></li><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/tags/ title=Tags>Tag</a></li><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/article/ title="Benvenuti su BBlog">Articoli</a></li><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=https://bortox.it/contribuisci-cs/ title>Supporta bortox.it 💰</a></li><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=https://uptime.bortox.it title>Status 📊</a></li><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/privacy/ title="Informativa sulla privacy di bortox.it">Informativa sulla privacy</a></li></ul></nav><div class="flex justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">Contenuto sotto licenza: <a href=https://creativecommons.org/licenses/by-nc-nd/4.0>🔗 CC BY-NC-ND 4.0</a></p><p class="text-xs text-neutral-500 dark:text-neutral-400">Sito basato su <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://git.io/hugo-congo target=_blank rel="noopener noreferrer">Congo</a></p></div></div><script type=module src=/sw.js></script>
<script>if("serviceWorker"in navigator){navigator.serviceWorker.register("/sw.js",{scope:"/"}).then(()=>{console.log("Service Worker Registered")});const e=!0,t=["index","next","prev","prefetch"];function prefetchCache(){if(navigator.serviceWorker.controller){for(var n=[],t=document.links,e=0;e<t.length;e++)t[e].rel==="prefetch"&&n.push(t[e].href);n.forEach(e=>navigator.serviceWorker.controller.postMessage({action:"cache",url:e}))}}navigator.serviceWorker.ready.then(()=>{prefetchCache()})}</script></footer></body></html>